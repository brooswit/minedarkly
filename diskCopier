local on = redstone.getInput("front")
local masterLabel = ""
local masterPath = ""
local targetPath = ""
local copied = false

while true do

  if not on then
    term.clear()
    term.write("Disk Copier: Off")
  else
    term.clear()
    term.write("Disk Copier: On")
  end
  
  if not disk.isPresent("left") then
    copied = false
    term.write("Master Copy: Not Present. Insert master copy into left disk drive.")
  else
    masterLabel = disk.getLabel("left")
    masterPath = disk.getMountPath("left")
    term.write("Master Copy: " .. masterLabel .. " (Present)")
  end
  
  if not disk.isPresent("right") then
    copied = false
    term.write("Target Disk: Not Present. Insert target disk into right disk drive.")
  else
    targetPath = disk.getMountPath("right")
    term.write("Target Disk: " .. masterLabel .. " (Present)")
  end
  
  if not (masterPath and targetPath) then
    term.write("Not Ready")
  elsif not (on) then
    term.write("Ready")
  elsif not copied then
    local targetFiles = fs.list(targetPath)
    for _, targetFile in ipairs(targetFiles) do
      targetFilePath = targetPath .. "/" .. targetFile
      fs.delete(targetFilePath
    end
    local masterFiles = fs.list(masterPath)
    for _, masterFile in ipairs(masterFiles) do
      masterFilePath = masterPath .. "/" .. masterFile
      targetFilePath = targetPath .. "/" .. masterFile
      fs.copy(masterFilePath, targetFilePath)
    end
    term.write("Coping... Do not remove target disk...")
    copied = true
  else
    term.write("Copied! Remove target disk")
end
